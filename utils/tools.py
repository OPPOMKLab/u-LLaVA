import torch
import requests
import datetime
from PIL import Image
from io import BytesIO


def disable_torch_init():
    """
    Disable the redundant torch default initialization to accelerate model creation.
    """
    setattr(torch.nn.Linear, "reset_parameters", lambda self: None)
    setattr(torch.nn.LayerNorm, "reset_parameters", lambda self: None)


def datetime_print(msg):
    print('[' + datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S,%f")[:-3] + '] ' + msg)


def load_image(image_file):
    if image_file.startswith('http') or image_file.startswith('https'):
        response = requests.get(image_file)
        image = Image.open(BytesIO(response.content)).convert('RGB')
    else:
        image = Image.open(image_file).convert('RGB')
    return image
